{% extends 'base.html' %}
{% block content %}
<div class="main-content">
  <h2 class="section-title"><i class="bi bi-person-plus"></i> Cadastrar Rosto</h2>
  <form method="post" enctype="multipart/form-data" id="form-cadastro">
    <div class="mb-3">
      <label for="nome" class="form-label">Nome</label>
      <input type="text" class="form-control" id="nome" name="nome" placeholder="Digite o nome da pessoa" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Tirar foto com webcam</label><br>
      <video id="video" width="320" height="240" autoplay class="rounded shadow"></video>
      <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
      <br>
      <button type="button" class="btn btn-action mt-2" id="btn-capturar"><i class="bi bi-camera"></i> Capturar Foto</button>
      <input type="hidden" name="img_data_url" id="img_data_url">
      <div id="preview" class="mt-2"></div>
    </div>
    <div class="mb-3">
      <label class="form-label">Ou selecione uma imagem</label>
      <input type="file" class="form-control" id="imagem" name="imagem" accept="image/*">
    </div>
    <button type="submit" class="btn btn-lg w-100 mt-3"><i class="bi bi-person-plus"></i> Cadastrar</button>
  </form>
</div>
<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const btnCapturar = document.getElementById('btn-capturar');
const imgDataUrl = document.getElementById('img_data_url');
const preview = document.getElementById('preview');

if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
    video.srcObject = stream;
    video.play();
  });
}

btnCapturar.onclick = function() {
  canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
  const dataUrl = canvas.toDataURL('image/jpeg');
  imgDataUrl.value = dataUrl;
  preview.innerHTML = `<img src="${dataUrl}" width="160" class="mt-2 rounded shadow"/>`;
};
</script>
{% endblock %}
